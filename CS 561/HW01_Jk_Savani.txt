NAME - JAY KALYANBHAI SAVANI

CWID - 20009207















QUESTION 1 

WITH RAW_DATA AS (SELECT S.PROD AS PRODUCT, MAX(S.QUANT) AS MAX_Q, MIN(S.QUANT) AS MIN_Q, AVG(S.QUANT) AS AVG_Q  FROM SALES S  GROUP BY S.PROD),

 M1 AS (SELECT R1.PRODUCT, R1.MAX_Q, S1.CUST AS MAX_CUST,  S1.DATE AS MAX_DATE,  S1.STATE AS ST, R1.AVG_Q FROM SALES AS S1, RAW_DATA AS R1

  WHERE S1.PROD = R1.PRODUCT AND S1.QUANT = R1.MAX_Q),

 M2 AS (SELECT R2.PRODUCT, R2.MIN_Q, S2.CUST AS MIN_CUST,  S2.DATE  AS MIN_DATE,  S2.STATE AS ST  FROM SALES S2, RAW_DATA R2

  WHERE S2.PROD = R2.PRODUCT AND S2.QUANT = R2.MIN_Q)

SELECT M1.PRODUCT,M1.MAX_Q,M1.MAX_CUST,M1.MAX_DATE,M1.ST,M2.MIN_Q,M2.MIN_CUST,M2.MIN_DATE,M2.ST,M1.AVG_Q 

FROM M1, M2

WHERE M1.PRODUCT = M2.PRODUCT;















QUESTION 2 



WITH RAW_DATA AS (

SELECT S1.CUST AS CUSTOMER, S1.PROD AS PRODUCT, S1.STATE, MAX(S1.QUANT) AS MAX_Q, MIN(S1.QUANT) AS MIN_Q 

FROM SALES S1 

GROUP BY S1.CUST, S1.PROD, S1.STATE),

NY AS( 

SELECT R1.CUSTOMER, R1.PRODUCT , R1.STATE , R1.MAX_Q NY_QUANT , S3.DATE NY_DATE 

FROM RAW_DATA R1 ,SALES S3

WHERE R1.STATE = S3.STATE

AND R1.STATE = 'NY'

AND R1.CUSTOMER = S3.CUST 

AND R1.PRODUCT = S3.PROD

AND R1.MAX_Q = S3.QUANT),

NJ_CT_DATE AS (SELECT R6.CUSTOMER, R6.PRODUCT, S7.STATE, R6.MIN_Q, S7.DATE 

FROM RAW_DATA R6 ,SALES S7

WHERE R6.CUSTOMER = S7.CUST

AND R6.PRODUCT = S7.PROD

AND R6.STATE = S7.STATE

AND R6.MIN_Q = S7.QUANT

AND S7.YEAR > 2000),

NJ AS( 

SELECT R2.CUSTOMER, R2.PRODUCT , R2.STATE , R2.MIN_Q NJ_QUANT ,NC1.DATE AS NJ_DATE

  FROM RAW_DATA R2,NJ_CT_DATE NC1

  WHERE R2.STATE = 'NJ'

AND R2.CUSTOMER = NC1.CUSTOMER

AND R2.PRODUCT = NC1.PRODUCT

AND R2.STATE = NC1.STATE

AND R2.MIN_Q = NC1.MIN_Q),

CT AS(SELECT R3.CUSTOMER, R3.PRODUCT , R3.STATE , R3.MIN_Q CT_QUANT, NC2.DATE AS CT_DATE

  FROM RAW_DATA R3 ,NJ_CT_DATE NC2

WHERE R3.CUSTOMER = NC2.CUSTOMER

AND R3.PRODUCT = NC2.PRODUCT

AND R3.MIN_Q = NC2.MIN_Q

AND R3.STATE = NC2.STATE

AND R3.STATE = 'CT')

SELECT NY.CUSTOMER, NY.PRODUCT, NY.NY_QUANT AS NY_MAX ,NY.NY_DATE AS DATE, NJ.NJ_QUANT NJ_MIN ,NJ.NJ_DATE AS DATE , CT.CT_QUANT CT_MIN, CT.CT_DATE AS DATE 

FROM NJ, NY, CT

WHERE NY.CUSTOMER = NJ.CUSTOMER

AND NY.PRODUCT = NJ.PRODUCT

AND NJ.CUSTOMER = CT.CUSTOMER

AND NJ.PRODUCT = CT.PRODUCT

AND NY.NY_QUANT > (NJ.NJ_QUANT + CT.CT_QUANT);



















QUESTION 3 



WITH RAW_DATA AS (SELECT MONTH ,STATE , SUM(QUANT) AS SUM_QUANT FROM SALES S 

GROUP BY S.MONTH, STATE

ORDER BY MONTH,SUM(QUANT)),

RAW_DATA2 AS (SELECT MONTH, MAX(SUM_QUANT) MOST_POP_CNT ,MIN(SUM_QUANT) LEAST_POP_CNT FROM RAW_DATA R1 

GROUP BY MONTH)

SELECT R2.MONTH, R.STATE AS MOST_POPULAR_ST, R2.MOST_POP_CNT AS MOST_POP_TOTAL_Q, R1.STATE AS LEAST_POPULAR_ST , R2.LEAST_POP_CNT AS LEAST_POP_TOTAL_Q   FROM RAW_DATA2 R2, RAW_DATA R,RAW_DATA R1

WHERE R.MONTH = R2.MONTH

AND R.SUM_QUANT = MOST_POP_CNT

AND R1.MONTH = R2.MONTH

AND R1.SUM_QUANT = LEAST_POP_CNT;















QUESTION 4 



WITH RAW_DATA AS (SELECT CUST,PROD,SUM(QUANT) S1 FROM SALES 

  GROUP BY CUST, PROD ORDER BY CUST, PROD),

RAW_DATA2 AS (SELECT R1.CUST,MAX(R1.S1) M1 FROM RAW_DATA R1 

  GROUP BY  R1.CUST),

F1 AS (SELECT R3.CUST,R3.PROD,R3.S1 MAXI FROM RAW_DATA R3,RAW_DATA2 RD2 

  WHERE R3.CUST = RD2.CUST AND R3.S1 = RD2.M1 ORDER BY R3.CUST,R3.PROD),

RAW_DATA3 AS(SELECT R2.CUST,MIN(R2.S1) M1 FROM RAW_DATA R2

GROUP BY  R2.CUST),

F2 AS(SELECT R4.CUST,R4.PROD,R4.S1 MINI FROM RAW_DATA R4 ,RAW_DATA3 RD3

  WHERE R4.CUST = RD3.CUST AND R4.S1 = RD3.M1 ORDER BY R4.CUST,R4.PROD),

F11 AS(SELECT F1.CUST, F1.PROD P1,F2.PROD P2 FROM F1,F2 

  WHERE F1.CUST = F2.CUST) ,  

RAW_DATA4 AS(SELECT CUST,PROD,STATE ,SUM(QUANT) S1 FROM SALES 

GROUP BY CUST, PROD,STATE ORDER BY CUST, PROD,STATE),

RAW_DATA5 AS(SELECT RD4.CUST,MAX(RD4.S1) M1 FROM RAW_DATA4 RD4

GROUP BY RD4.CUST),

F3 AS(SELECT RD4.CUST,RD4.STATE FROM RAW_DATA4 RD4,RAW_DATA5 RD5

  WHERE RD4.CUST = RD5.CUST AND RD4.S1 = RD5.M1),

RAW_DATA6 AS(SELECT RD4.CUST,MIN(RD4.S1) M1 FROM RAW_DATA4 RD4 

GROUP BY RD4.CUST),

F4 AS(SELECT RD4.CUST,RD4.STATE FROM RAW_DATA4 RD4,RAW_DATA6 RD6 

  WHERE RD4.CUST = RD6.CUST AND RD4.S1 = RD6.M1),

F22 AS(SELECT F3.CUST,F3.STATE S1, F4.STATE S2 FROM F3,F4

WHERE F3.CUST = F4.CUST)

SELECT F11.CUST AS CUSTOMER,F11.P1 AS MOST_FAV_PROD,F11.P2 LEAST_FAV_PROD , F22.S1 AS MOST_FAV_ST,F22.S2 AS LEAST_FAV_ST

FROM F11, F22

WHERE F11.CUST = F22.CUST;















QUESTION 5 



WITH RAW_DATA AS (SELECT S.CUST, S.PROD , SUM(QUANT) TOTAL, AVG(QUANT) AVERAGE,COUNT(QUANT)  FROM SALES S GROUP BY S.CUST,S.PROD),

RAW_DATA2 AS (SELECT CUST, PROD, MONTH, SUM(S.QUANT) AS  SUM_QUANT FROM SALES S GROUP BY S.CUST, S.PROD, S.MONTH),

RAW_DATA_Q1 AS (SELECT CUST,PROD, SUM(SUM_QUANT) AS Q1 FROM RAW_DATA2 R2 WHERE R2.MONTH IN (1,2,3) GROUP BY R2.CUST, R2.PROD),

RAW_DATA_Q2 AS (SELECT CUST,PROD, SUM(SUM_QUANT) AS Q2 FROM RAW_DATA2 R3 WHERE R3.MONTH IN (4,5,6) GROUP BY R3.CUST, R3.PROD),

RAW_DATA_Q3 AS (SELECT CUST,PROD, SUM(SUM_QUANT) AS Q3 FROM RAW_DATA2 R4 WHERE R4.MONTH IN (7,8,9) GROUP BY R4.CUST, R4.PROD),

RAW_DATA_Q4 AS (SELECT CUST,PROD, SUM(SUM_QUANT) AS Q4 FROM RAW_DATA2 R5 WHERE R5.MONTH IN (10,11,12) GROUP BY R5.CUST, R5.PROD)

SELECT RD1.CUST AS CUSTOMER, RD1.PROD AS PRODUCT, RD1.Q1 AS Q1_TOT, RD2.Q2 AS Q2_TOT ,RD3.Q3 AS Q3_TOT,RD4.Q4 Q4_TOT ,RD.AVERAGE,RD.TOTAL, RD.COUNT

FROM RAW_DATA_Q1 RD1, RAW_DATA_Q2 RD2,RAW_DATA_Q3 RD3,RAW_DATA_Q4 RD4,RAW_DATA RD

WHERE RD1.CUST = RD2.CUST

AND RD1.PROD = RD2.PROD

AND RD2.CUST = RD3.CUST

AND RD2.PROD = RD3.PROD

AND RD3.CUST = RD4.CUST

AND RD3.PROD = RD4.PROD

AND RD4.CUST = RD.CUST

AND RD4.PROD = RD.PROD;
